<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SBI Mini Statement</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #d7fcfc;
      font-family: Arial, sans-serif;
    }

    .form-container {
      background: white;
      padding: 30px;
      margin-top: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px #ccc;
    }

    .sbi-header {
      color: #003366;
      font-weight: bold;
      font-size: 24px;
    }

    .transaction-list {
      font-size: 14px;
      line-height: 1.8;
      margin-top: 15px;
      border-top: 1px dashed #ccc;
      padding-top: 15px;
    }

    .balance {
      font-size: 16px;
      font-weight: bold;
      margin-top: 10px;
      color: #2c5c2f;
    }

    .btn-print {
      background-color: #418c61;
      color: white;
    }

    .btn-print:hover {
      background-color: #58a075;
    }

    .btn-back {
      background-color: #b13d3d;
      color: white;
    }

    .btn-back:hover {
      background-color: #d04b4b;
    }

    @media print {
  body * {
    visibility: hidden;
  }

  #printArea, #printArea * {
    visibility: visible;
  }

  #printArea {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
  }

  .no-print {
    display: none !important;
  }
}

  </style>
</head>
<body>

<div class="container">
  <div class="form-container">

    <div class="row align-items-center mb-4">
      <div class="col-md-2">
        <img src="images/sbi_logo.jpg" alt="Bank Logo" width="100%">
      </div>
      <div class="col-md-8 text-center sbi-header">
        State Bank of India <br> Mini Statement
      </div>
      <div class="col-md-2 text-end">
        <label><strong>Date:</strong></label><br>
        <span id="todayDate"></span>
      </div>
    </div>

      
    <form onreset="clearFields()">
  <div class="mb-3">
    <label><strong>Enter PIN to View Statement:</strong></label><br>
    <input type="password" id="pinInput" placeholder="Enter PIN" class="form-control w-50 d-inline">
    <button type="button" class="btn btn-primary ms-2" onclick="fetchStatement()">OK</button>
  </div>
</form>

<!-- Print  -->
<div id="printArea">
  <div class="mb-3">
    <label><strong>Card Number:</strong></label>
    <span id="cardNumber">Waiting for PIN...</span>
  </div>

  <div class="transaction-list" id="statementData">
    Please enter PIN to load statement.
  </div>

  <div class="balance" id="balanceData"></div>
</div>

<!--  buttons -->
<div class="text-center mt-4 no-print">
  <button class="btn btn-print me-3" onclick="printOnly()">PRINT</button>
  <button class="btn btn-back" onclick="window.location.href='dashboard.html'">BACK</button>
  <button class="btn btn-secondary" onclick="clearFields()">CLEAR</button>
</div>




  </div>
</div>

<script>
  // Show current date
  document.getElementById("todayDate").innerText = new Date().toLocaleDateString();

  function fetchStatement() {
    const pin = document.getElementById("pinInput").value.trim();

    if (!pin) {
      alert("Please enter your PIN.");
      return;
    }

    fetch("http://localhost:8087/atm/getStatementByPin/" + pin)
      .then(res => res.ok ? res.json() : Promise.reject("Invalid PIN or no data"))
      .then(data => {
        const cardNo = data.cardNo;
        const transactions = data.transactions;
        const balance = data.balance;

        const masked = cardNo.substring(0, 4) + "XXXXXXXX" + cardNo.slice(-2);
        document.getElementById("cardNumber").innerText = masked;

        // let html = "<strong>Date &nbsp;&nbsp;&nbsp;&nbsp; Type &nbsp;&nbsp;&nbsp;&nbsp; Amount</strong><br>";
        // transactions.forEach(t => {
        //   html += `${t.date} &nbsp;&nbsp;&nbsp;&nbsp; ${t.type} &nbsp;&nbsp;&nbsp;&nbsp; Rs. ${t.amount}<br>`;
        // });


                      let html = `
                <table style="width:100%; font-family:Courier New, monospace; font-size:14px; border-collapse:collapse;">
                  <thead>
                    <tr style="border-bottom:1px dashed #000;">
                      <th style="text-align:left;">Date</th>
                      <th style="text-align:left;">Type</th>
                      <th style="text-align:left;">Name</th>
                      <th style="text-align:right;">Amount (Rs.)</th>
                    </tr>
                  </thead>
                  <tbody>
              `;

              transactions.forEach(t => {
                html += `
                    <tr style="border-bottom:1px dashed #ccc;">
                      <td>${t.date}</td>
                      <td>${t.type}</td>
                      <td>${t.name}</td>
                      <td style="text-align:right;">${t.amount}</td>
                    </tr>
                `;
              });

              html += `
                  </tbody>
                </table>
              `;


        document.getElementById("statementData").innerHTML = html;
        document.getElementById("balanceData").innerText = "Your Total Balance is Rs. " + balance;

        //window.location.href="print_receipt.html";
      })
      .catch(err => {
        alert(err);
        document.getElementById("statementData").innerText = "Failed to load statement.";
        document.getElementById("balanceData").innerText = "";
        document.getElementById("cardNumber").innerText = "Not found";
      });
  }
</script>


<script>
  function clearFields() {
    document.getElementById("pinInput").value = "";
    document.getElementById("cardNumber").innerText = "Waiting for PIN...";
    document.getElementById("statementData").innerText = "Please enter PIN to load statement.";
    document.getElementById("balanceData").innerText = "";
  }
</script>


<script>
  function printOnly() {
    window.print();
  }
</script>



</body>
</html>
